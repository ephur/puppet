<VirtualHost *:80>
  # Force HTTPS when requests come to port 80
  ServerName integrity.ephur.net
  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<VirtualHost *:443>
  # Basic server settings
  ServerName integrity.slicehost.com

  RewriteEngine On
  RewriteCond %{REQUEST_URI} ^/downloads
  RewriteRule ^/downloads(.*)$ http://localhost:9000/sabnzbd$1 [P]


  # Log settings
  CustomLog ${APACHE_LOG_DIR}/carrot.ephur.net_access.log combined
  ErrorLog ${APACHE_LOG_DIR}/carrot.ephur.net_error.log
  LogLevel info
  LogLevel warn

  # SSL Settings
  SSLEngine on
  SSLCertificateKeyFile /etc/apache2/ssl/carrots.ephur.net.key
  SSLCertificateFile    /etc/apache2/ssl/carrots.ephur.net.cert

  BrowserMatch "MSIE [2-6]" \
              nokeepalive ssl-unclean-shutdown \
              downgrade-1.0 force-response-1.0
  BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

  DocumentRoot /var/www

  <Directory /var/www/>
      Order allow,deny
      Allow from all
      AuthName "You know what to do"
      AuthType Basic
      AuthBasicProvider file
      AuthUserFile /etc/apache2/htpasswd
      Require valid-user
  </Directory>

  <Location />
      Order allow,deny
      Allow from all
      AuthName "You know what to do"
      AuthType Basic
      AuthBasicProvider file
      AuthUserFile /etc/apache2/htpasswd
      Require valid-user
  </Location>

  <Location /downloads>
    order deny,allow
    deny from all
    allow from all
      ProxyPass http://localhost:9000/sabnzbd
    ProxyPassReverse http://localhost:9000/sabnzbd
  </Location>

  <Location /music>
    order deny,allow
    deny from all
    allow from all
    ProxyPass http://localhost:9001/music
    ProxyPassReverse http://localhost:9001/music
  </Location>


</VirtualHost>